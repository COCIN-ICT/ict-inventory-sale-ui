<div class="p-4">
  <!-- Success Message -->
  <div *ngIf="successMessage" class="bg-green-50 text-green-700 border border-green-200 px-4 py-3 rounded-lg mb-4 relative flex items-center">
    <span>{{ successMessage }}</span>
    <button class="absolute top-2 right-2 text-green-600 hover:text-green-800 transition-colors duration-200" (click)="successMessage=''">
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
      </svg>
    </button>
  </div>

  <div class="flex items-center justify-between mb-4">
    <h2 class="text-lg font-medium">Pending Sales Credits</h2>
    <div class="flex space-x-2">
      <button (click)="goToAllCredits()" class="px-4 py-2 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
        All Credits
      </button>
      <a routerLink="/home/sales-credit/create" class="btn btn-primary">Create Credit</a>
    </div>
  </div>

  <div class="bg-white shadow-sm rounded-lg overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sales Order</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Expected Repayment</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created Date</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <tr *ngFor="let credit of pendingCredits" class="hover:bg-gray-50">
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ credit.id }}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            Order #{{ credit.salesOrderId }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            â‚¦{{ credit.amount | number:'1.2-2' }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            {{ credit.expectedRepaymentDate | date:'medium' }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full" [class]="getStatusColor(credit.status)">
              {{ credit.status }}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            {{ credit.createdAt | date:'short' }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <div class="flex space-x-2">
              <button (click)="viewCredit(credit.id)" 
                class="text-blue-600 hover:text-blue-900 transition-colors">
                View
              </button>
              <button (click)="openApproveModal(credit)" 
                class="text-green-600 hover:text-green-900 transition-colors">
                Approve
              </button>
              <button (click)="openApproveByIdModal(credit.id)" 
                class="text-purple-600 hover:text-purple-900 transition-colors">
                Quick Approve
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="!loading && pendingCredits.length === 0">
          <td colspan="7" class="px-6 py-4 text-center text-gray-500">No pending sales credits found</td>
        </tr>
        <tr *ngIf="loading">
          <td colspan="7" class="px-6 py-4 text-center text-gray-500">Loading...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Approve Modal with Payment Details -->
  <div *ngIf="showApproveModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
      <div class="mt-3">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Approve Credit with Payment</h3>
        
        <!-- Error Message -->
        <div *ngIf="errorMessage" class="bg-red-50 text-red-700 border border-red-200 px-4 py-3 rounded-lg mb-4">
          {{ errorMessage }}
        </div>

        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">Payment Amount <span class="text-red-500">*</span></label>
            <input type="number" [(ngModel)]="approveData.amount" min="0" step="0.01"
              class="w-full px-3 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">Payment Method <span class="text-red-500">*</span></label>
            <select [(ngModel)]="approveData.paymentMethod"
              class="w-full px-3 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="CASH">Cash</option>
              <option value="TRANSFER">Transfer</option>
              <option value="DEPOSIT">Deposit</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-600 mb-1">Bank Account <span class="text-red-500">*</span></label>
            <select [(ngModel)]="approveData.accountId"
              class="w-full px-3 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option value="0">Select Bank Account</option>
              <option *ngFor="let account of bankAccounts" [value]="account.id">
                {{ account.accountName }} - {{ account.accountNumber }}
              </option>
            </select>
          </div>
        </div>

        <div class="flex justify-end space-x-3 mt-6">
          <button (click)="closeModals()" 
            class="px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
            Cancel
          </button>
          <button (click)="approveCreditWithPayment()" 
            class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors">
            Approve
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Approve Modal -->
  <div *ngIf="showApproveByIdModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
      <div class="mt-3">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Quick Approve Credit</h3>
        
        <!-- Error Message -->
        <div *ngIf="errorMessage" class="bg-red-50 text-red-700 border border-red-200 px-4 py-3 rounded-lg mb-4">
          {{ errorMessage }}
        </div>

        <p class="text-sm text-gray-600 mb-4">
          Are you sure you want to approve credit #{{ creditIdToApprove }}?
        </p>

        <div class="flex justify-end space-x-3">
          <button (click)="closeModals()" 
            class="px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
            Cancel
          </button>
          <button (click)="approveCreditById()" 
            class="px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors">
            Approve
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
